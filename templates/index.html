<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Apollolume</title>
    <meta name="description"
          content="Apollolume"/>

    <!--Inter UI font-->
    <link href="https://rsms.me/inter/inter-ui.css" rel="stylesheet">

    <!--vendors styles-->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/slick-carousel/1.8.1/slick.min.css">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/slick-carousel/1.8.1/slick-theme.min.css">

    <!-- Bootstrap CSS / Color Scheme -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/default.css') }}" id="theme-color">

    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>
<body>

<!--navigation-->
<section class="smart-scroll">
    <div class="container-fluid">
        <nav class="navbar navbar-expand-md navbar-dark">
            <a class="navbar-brand heading-black" href="index.html" style="pointer-events: none; cursor: default;">
                Apollolume
            </a>
                  
            <button class="navbar-toggler navbar-toggler-right border-0" type="button" data-toggle="collapse"
                    data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false"
                    aria-label="Toggle navigation">
                <span data-feather="grid"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link page-scroll" href="#home">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link page-scroll" href="#features">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link page-scroll" href="#Services">Services</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>
</section>

<!--hero header-->
<section class="py-7 py-md-0 bg-hero" id="home">
    <div class="container">
        <div class="row vh-md-100">
            <div class="col-md-8 col-sm-10 col-12 mx-auto my-auto text-center">
                <h1 class="heading-black text-capitalize">Apollolume</h1>
                <p class="lead py-3">Apollolume is an application that helps users enhance photos taken at night or in low light conditions.</p>
                    <button class="btn btn-primary d-inline-flex flex-row align-items-center" id="get-started-button">
                        Get started now
                        <em class="ml-2" data-feather="arrow-right"></em>
                    </button>
                    
            </div>
        </div>
    </div>
</section>

<!-- features section -->
<section class="pt-6 pb-7" id="features">
    <div class="container">
        <div class="row">
            <div class="col-md-6 mx-auto text-center">
                <h2 class="heading-black">We provide easy and high quality photo/video enhancement.</h2>
                <p class="text-muted lead">Apollolume offers everything you need for low light photo/video enhancement.</p>
            </div>
        </div>
        <div class="row mt-5">
            <div class="col-md-10 mx-auto">
                <div class="row feature-boxes">
                    <div class="col-md-6 box">
                        <div class="icon-box box-primary">
                            <div class="icon-box-inner">
                                <span data-feather="edit-3" width="35" height="35"></span>
                            </div>
                        </div>
                        <h5>Step1: Take low-light images/videos</h5>
                        <p class="text-muted">Our application can handel any kind of image imputs and Video files without audio.</p>
                    </div>
                    <div class="col-md-6 box">
                        <div class="icon-box box-success">
                            <div class="icon-box-inner">
                                <span data-feather="monitor" width="35" height="35"></span>
                            </div>
                        </div>
                        <h5>Step2: Save them on a PC device</h5>
                        <p class="text-muted">Please do save them as files on your personal computer so that you can upload them into our application.</p>
                    </div>
                    <div class="col-md-6 box">
                        <div class="icon-box box-danger">
                            <div class="icon-box-inner">
                                <span data-feather="layout" width="35" height="35"></span>
                            </div>
                        </div>
                        <h5>Step3: Use our Appololume</h5>
                        <p class="text-muted">After you get into our application page, please select the function you want to use below, and upload corresponding files.</p>
                    </div>
                    <div class="col-md-6 box">
                        <div class="icon-box box-info">
                            <div class="icon-box-inner">
                                <span data-feather="globe" width="35" height="35"></span>
                            </div>
                        </div>
                        <h5>Step4: Receive enhanced output</h5>
                        <p class="text-muted">You can get your enhance photos/videos by simplying clicking on the convert button and wait for a few seconds.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-6">
            <div class="col-md-6 mr-auto">
                <h2>...But Apollolume is more than just a photo/video enhancer.</h2>
                <p class="text-muted">We also provide real-time camera enhancement and together with violence detection.</p>
                <!-- <button class="btn btn-light" id="show-image-button">
                    Try the live demo
                </button>                 -->
            </div>
            <div class="col-md-6" id="camera-stream-div">
                <img src="{{ url_for('static', filename="img/fighting.jpg") }}">
            </div>            
        </div>
    </div>
</section>


<!--Services section-->
<section class="py-7 bg-dark section-angle top-left bottom-left" id="Services">
    <div class="container">
        <div class="row justify-content-center mb-4">
            <div class="col-md-6 mx-auto text-center">
                <h2 class="heading-black" id="Services">Services</h2>
                <p class="text-muted lead">"Then God said, 'Let there be light,' and there was light." (Genesis 1:3)</p>
            </div>
        </div>
        <div class="row mb-6">
            <div class="col-md-4">
                <button class="btn btn-primary btn-block" id="picture-button">
                    Picture
                </button>
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary btn-block" id="video-button">
                    Video
                </button>
            </div>
            <div class="col-md-4">
                <button class="btn btn-primary btn-block" id="camera-button">
                    Real-time Camera
                </button>
            </div>
        </div>

        <div class="row justify-content-center mb-4">
            <div class="col-md-4 mx-auto text-center">
                <input type="file" class="row mb-4" id="picture-upload" name="picture" style="display: none" accept="image/*">
                <input type="file" class="row mb-4" id="video-upload" name="video" style="display: none" accept="video/*">
                <div class="col-md-5" id="camera-stream-div2" style="display: none;">
                    <img id="camera-stream" src="" alt="Camera Stream">
                </div>
                <div id="new-content-area">

                </div>
            </div>
            <div class="col-md-3 mx-auto text-center">
                <button class="btn btn-primary" id="convert-button">
                    Convert
                </button>
                <button class="btn btn-primary" id="enable-camera-button" style="display: none;">
                    Enable Camera
                </button>
                <div class="col-md-3 mx-auto text-center button-container">
                    <button class="btn btn-primary" id="detect-button" style="display: none;">
                        Detect
                    </button>
                    <button class="btn btn-primary" id="stop-button" style="display: none;">
                        Stop
                    </button>
                </div>
                
            </div>
            <div class="col-md-4 mx-auto text-center">
                <p class="text-muted lead" id="result-preview-text">

                </p>
                <img id="picture-preview" src="" alt="Picture Preview" class="preview-image">
                <video id="video-preview" class="preview-image"controls style="display: none;"></video>


            </div>
        </div>
        
    </div>
</section>


<!--footer-->
<footer class="py-6">
    <div class="container">
        <div class="row mt-5">
            <div class="col-12 text-muted text-center small-xl">

            </div>
        </div>
    </div>
</footer>

<!--scroll to top-->
<div class="scroll-top">
    <i class="fa fa-angle-up" aria-hidden="true"></i>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const getStartedButton = document.getElementById("get-started-button");
        const blogSection = document.getElementById("Services");

        getStartedButton.addEventListener("click", function () {
            blogSection.scrollIntoView({ behavior: "smooth" });
        });
    });

    document.getElementById("enable-camera-button").addEventListener("click", function() {

    var cameraStreamUrl = "{{ url_for('video_feed') }}"; 
    document.getElementById("camera-stream").src = cameraStreamUrl;

    document.getElementById("detect-button").addEventListener("click", function() {

});

});

document.addEventListener("DOMContentLoaded", function () {
    let counter = 0; 


    function captureAndSendImage() {

    const cameraStreamImage = document.getElementById("camera-stream");

    // Create a canvas element to capture the image
    const canvas = document.createElement("canvas");
    canvas.width = cameraStreamImage.width;
    canvas.height = cameraStreamImage.height;
    const context = canvas.getContext("2d");
    context.drawImage(cameraStreamImage, 0, 0, canvas.width, canvas.height);

    const capturedImageDataURL = canvas.toDataURL("image/jpeg");

    // Create a Blob from the data URL
    const capturedImageBlob = dataURLtoBlob(capturedImageDataURL);

    // Create a FormData object to send the image
    const formData = new FormData();
    formData.append("image", capturedImageBlob);

    // Send the image to the backend
    fetch("/detect", {
        method: "POST",
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        // Handle the response from the backend
        sig = "";
        if (data.predicted_class) {
            // Update the result preview with the predicted class
            if (data.predicted_class == "0") {
                sig = "fall";
                alert("Falling situation detected!")
            }
            else if (data.predicted_class == "1") {
                sig = "normal"
            }
            else {
                sig = "violence"
                alert("Violent situation detected!")
            }

            document.getElementById("result-preview-text").textContent = "Predicted Result: " + sig;
        }
    })
    .catch(error => {
        console.error("Error uploading image: " + error);
    });
}

// Function to convert a data URL to a Blob
function dataURLtoBlob(dataURL) {
    const parts = dataURL.split(",");
    const byteString = atob(parts[1]);
    const mimeString = parts[0].split(":")[1].split(";")[0];

    const arr = new Uint8Array(byteString.length);
    for (let i = 0; i < byteString.length; i++) {
        arr[i] = byteString.charCodeAt(i);
    }

    return new Blob([arr], { type: mimeString });
}


    document.getElementById("detect-button").addEventListener("click", function () {

        const intervalId = setInterval(captureAndSendImage, 2000);

        document.getElementById("detect-button").style.display = "none";
        document.getElementById("stop-button").style.display = "block";

        document.getElementById("stop-button").addEventListener("click", function () {
            clearInterval(intervalId);
            document.getElementById("detect-button").style.display = "block";
            document.getElementById("stop-button").style.display = "none";
        });
    });
});

    



</script>

<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/feather-icons/4.7.3/feather.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/slick-carousel/1.8.1/slick.min.js"></script>
<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
</body>
</html>